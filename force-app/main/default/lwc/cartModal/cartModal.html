<template>
  <div class="modal-backdrop">
    <div class="modal-container">
      <!-- Header -->
      <div class="modal-header">
        <h2>Shopping Cart</h2>
        <button class="close-button" onclick={handleClose}>×</button>
      </div>

      <!-- Cart Content -->
      <div class="cart-content">
        <!-- Cart Items -->
        <div class="cart-items">
          <template if:true={hasItems}>
            <table class="cart-table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Sqft</th>
                  <th>Disc Value</th>
                  <th>{afterDiscPriceLabel}</th>
                  <th>Line Total</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <template for:each={cartItems} for:item="item">
                  <tr key={item.id} class="cart-item">
                    <td class="product-info">
                      <img src={item.imageUrl} alt={item.name} />
                      <div>
                        <h3>{item.name}</h3>
                        <div class="product-code">{item.code}</div>
                      </div>
                    </td>
                    <td data-label="Quantity">
                      <div class="quantity-controls">
                        <button class="qty-btn" onclick={handleDecrease} data-id={item.id}>-</button>
                        <input type="number" value={item.quantity} min="1" data-id={item.id}
                          onchange={handleQuantityChange} />
                        <button class="qty-btn" onclick={handleIncrease} data-id={item.id}>+</button>
                      </div>
                    </td>
                    <td data-label="Unit Price">₹{item.unitPriceDisplay}</td>
                    <td data-label="Sqft">{item.sqft}</td>
                    <td data-label="Disc Value">{item.discValue} {item.discountSymbol}</td>
                    <td data-label={afterDiscPriceLabel}>₹{item.afterDiscDisplay}</td>
                    <td data-label="Line Total" class="line-total">₹{item.lineTotalDisplay}</td>
                    <td>
                      <div class="action-buttons">
                        <c-wishlist-item product-id={item.id} opportunity-id={recordId}
                          onwishlistadd={handleWishlistAdd}></c-wishlist-item>
                        <button class="remove-button" data-id={item.id} onclick={handleRemoveItem}>
                          <svg class="trash-icon" viewBox="0 0 24 24">
                            <path
                              d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                          </svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </template>
          <template if:false={hasItems}>
            <div class="empty-cart">
              <p>Your cart is empty</p>
            </div>
          </template>
        </div>

        <!-- Cart Summary -->
        <div class="cart-summary">
          <h3>Order Summary</h3>
          <div class="summary-row">
            <span>Subtotal</span>
            <span>₹{subtotal}</span>
          </div>

          <!-- Additional Charges -->
          <div class="charges-section">
            <h4>Additional Charges</h4>
            <div class="charge-row">
              <label>Freight Charge (₹)</label>
              <input type="number" value={freightCharge} onchange={handleFreightChargeChange} />
            </div>
            <div class="charge-row">
              <label>Loading Charge (₹)</label>
              <input type="number" value={loadingCharge} onchange={handleLoadingChargeChange} />
            </div>
            <div class="charge-row">
              <label>Unloading Charge (₹)</label>
              <input type="number" value={unloadingCharge} onchange={handleUnloadingChargeChange} />
            </div>
          </div>

          <div class="summary-row total">
            <span>Order Total</span>
            <span>₹{orderTotal}</span>
          </div>
          <button class="checkout-button" onclick={handleConfirm}>
            Confirm Order
          </button>
        </div>
      </div>
    </div>
  </div>
</template>